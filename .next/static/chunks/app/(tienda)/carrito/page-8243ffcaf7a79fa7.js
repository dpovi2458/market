(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{291:function(e,t,r){Promise.resolve().then(r.bind(r,5159))},5159:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var a=r(7437),n=r(2265),s=r(9376),o=r(471),i=r(6941),l=r(9382);function c(){let{items:e,updateCantidad:t,removeItem:r,clear:c}=(0,o.A)(),[u,m]=(0,n.useState)(1),[p,x]=(0,n.useState)(!1),[f,h]=(0,n.useState)({nombre:"",telefono:"",email:"",punto_entrega:"",comentarios:""}),[g,b]=(0,n.useState)({}),y=(0,s.useRouter)(),j=e.reduce((e,t)=>e+t.precio*t.cantidad,0);async function v(){if(function(){let e={};if(f.nombre||(e.nombre="Requerido"),f.telefono){var t;t=f.telefono,/^(\+?\d{6,15})$/.test(String(t||"").replace(/\s|-/g,""))||(e.telefono="Formato inv\xe1lido")}else e.telefono="Requerido";return f.punto_entrega||(e.punto_entrega="Requerido"),b(e),0===Object.keys(e).length}()){x(!0);try{let t=await fetch("/api/pedidos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e,comprador:f})}),r=await t.json().catch(()=>null);if(!t.ok)throw Error((null==r?void 0:r.error)||"Error al crear pedido");c(),y.replace("/pedido-exitoso")}catch(e){alert(e.message)}finally{x(!1)}}}return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold mb-4",children:"Tu pedido"}),(0,a.jsx)(d,{step:u}),1===u&&(0,a.jsxs)("div",{className:"space-y-4 mt-4",children:[0===e.length&&(0,a.jsx)("p",{className:"text-gray-600",children:"No hay productos en el carrito."}),(0,a.jsx)("ul",{className:"divide-y bg-white rounded-xl border",children:e.map(e=>(0,a.jsxs)("li",{className:"p-3 flex gap-3 items-center",children:[e.imagen&&(0,a.jsx)("img",{src:e.imagen,alt:e.titulo,className:"w-16 h-16 object-cover rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium",children:e.titulo}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["S/ ",e.precio.toFixed(2)]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("button",{className:"px-2 py-1 border rounded",onClick:()=>t(e.producto_id,Math.max(1,e.cantidad-1)),children:"-"}),(0,a.jsx)("span",{children:e.cantidad}),(0,a.jsx)("button",{className:"px-2 py-1 border rounded",onClick:()=>{var r;return t(e.producto_id,Math.min(null!==(r=e.stock)&&void 0!==r?r:99,e.cantidad+1))},children:"+"}),(0,a.jsx)("button",{className:"ml-3 text-danger text-sm",onClick:()=>r(e.producto_id),children:"Eliminar"})]})]}),(0,a.jsxs)("div",{className:"font-semibold",children:["S/ ",(e.precio*e.cantidad).toFixed(2)]})]},e.producto_id))}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-semibold",children:"Total"}),(0,a.jsxs)("span",{className:"text-lg font-semibold",children:["S/ ",j.toFixed(2)]})]}),(0,a.jsx)(i.Z,{onClick:()=>m(2),disabled:0===e.length,children:"Proceder a pedir"})]}),2===u&&(0,a.jsxs)("div",{className:"bg-white rounded-xl p-4 border mt-4 space-y-3",children:[(0,a.jsx)(l.Z,{label:"Nombre completo*",value:f.nombre,onChange:e=>h({...f,nombre:e.target.value}),error:g.nombre}),(0,a.jsx)(l.Z,{label:"WhatsApp/Tel\xe9fono*",value:f.telefono,onChange:e=>h({...f,telefono:e.target.value}),error:g.telefono}),(0,a.jsx)(l.Z,{label:"Email",type:"email",value:f.email,onChange:e=>h({...f,email:e.target.value})}),(0,a.jsx)(l.Z,{label:"Punto de entrega*",value:f.punto_entrega,onChange:e=>h({...f,punto_entrega:e.target.value}),error:g.punto_entrega}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comentarios adicionales"}),(0,a.jsx)("textarea",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary",rows:3,value:f.comentarios,onChange:e=>h({...f,comentarios:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,a.jsx)(i.Z,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",onClick:()=>m(1),children:"Volver"}),(0,a.jsx)(i.Z,{loading:p,onClick:v,children:"Confirmar pedido"})]})]})]})}function d(e){let{step:t}=e,r=["Revisar carrito","Datos de contacto"];return(0,a.jsx)("div",{className:"flex items-center gap-3 text-sm",children:r.map((e,n)=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-6 h-6 rounded-full flex items-center justify-center text-white text-xs ".concat(n+1<=t?"bg-primary":"bg-gray-300"),children:n+1}),(0,a.jsx)("span",{className:"".concat(n+1===t?"font-semibold":"text-gray-600"),children:e}),n<r.length-1&&(0,a.jsx)("span",{className:"text-gray-400",children:"/"})]},n))})}},6941:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(7437);function n(e){let{children:t,className:r="",loading:n=!1,...s}=e;return(0,a.jsxs)("button",{className:"btn-primary inline-flex items-center justify-center min-h-[44px] ".concat(r),disabled:n||s.disabled,...s,children:[n&&(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),t]})}},9382:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(7437);function n(e){let{label:t,error:r,className:n="",...s}=e;return(0,a.jsxs)("label",{className:"block w-full",children:[t&&(0,a.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-1",children:t}),(0,a.jsx)("input",{className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary ".concat(n),...s}),r&&(0,a.jsx)("span",{className:"text-sm text-danger mt-1 block",children:r})]})}},471:function(e,t,r){"use strict";r.d(t,{A:function(){return l},CarritoProvider:function(){return i}});var a=r(7437),n=r(2265);let s=(0,n.createContext)();function o(e,t){switch(t.type){case"INIT":return t.payload||[];case"ADD":if(e.find(e=>e.producto_id===t.payload.producto_id))return e.map(e=>{var r;return e.producto_id===t.payload.producto_id?{...e,cantidad:Math.min(null!==(r=e.stock)&&void 0!==r?r:99,e.cantidad+t.payload.cantidad)}:e});return[...e,t.payload];case"UPDATE_QTY":return e.map(e=>e.producto_id===t.id?{...e,cantidad:t.cantidad}:e);case"REMOVE":return e.filter(e=>e.producto_id!==t.id);case"CLEAR":return[];default:return e}}function i(e){let{children:t}=e,[r,i]=(0,n.useReducer)(o,[]),[l,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{try{let e=localStorage.getItem("carrito");e&&i({type:"INIT",payload:JSON.parse(e)})}catch(e){}},[]),(0,n.useEffect)(()=>{try{localStorage.setItem("carrito",JSON.stringify(r))}catch(e){}},[r]);let d=(0,n.useMemo)(()=>({items:r,open:l,setOpen:c,addItem:e=>i({type:"ADD",payload:e}),updateCantidad:(e,t)=>i({type:"UPDATE_QTY",id:e,cantidad:t}),removeItem:e=>i({type:"REMOVE",id:e}),clear:()=>i({type:"CLEAR"})}),[r,l]);return(0,a.jsx)(s.Provider,{value:d,children:t})}function l(){let e=(0,n.useContext)(s);if(!e)throw Error("useCarrito debe usarse dentro de CarritoProvider");return e}},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=291)}),_N_E=e.O()}]);