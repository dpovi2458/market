"use strict";(()=>{var e={};e.id=281,e.ids=[281],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},30093:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>q,requestAsyncStorage:()=>v,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>l,POST:()=>g,runtime:()=>p});var n=r(49303),i=r(88716),a=r(60670),s=r(87070),u=r(21067),c=r(59094),d=r(77999);let p="nodejs";async function l(e){let{searchParams:t}=new URL(e.url),r=t.get("q")||"",o=t.get("categoria")||"",n=Number(t.get("limit")||24),i=Number(t.get("page")||1),a=await (0,c.F)(),u={disponible:!0,stock:{$gt:0}};r&&(u.$or=[{titulo:{$regex:r,$options:"i"}},{descripcion:{$regex:r,$options:"i"}}]),o&&(u.categoria=o);let[d,p]=await Promise.all([a.find(u).sort({fecha_creacion:-1}).skip((i-1)*n).limit(n).lean(),a.countDocuments(u)]);return s.NextResponse.json({items:d,total:p})}let m=u.Ry({titulo:u.Z_().min(1).max(100),descripcion:u.Z_().min(1).max(500),precio:u.Rx().nonnegative(),categoria:u.Km(["utiles","comida","tecnologia","ropa","otros"]),imagenes:u.IX(u.Z_().url()).max(3).optional().default([]),stock:u.Rx().int().min(0),disponible:u.O7().optional().default(!0),vendedor_id:u.Z_().optional(),vendedor_nombre:u.Z_().optional()});async function g(e){try{let t=await e.json(),r=m.parse(t),o=(0,d.Cr)();o&&(r.vendedor_id=o.id,r.vendedor_nombre=r.vendedor_nombre||o.nombre||"Vendedor");let n=await (0,c.F)(),i=await n.create(r);return s.NextResponse.json(i,{status:201})}catch(t){let e=t?.errors?.[0]?.message||t.message||"Error";return s.NextResponse.json({error:e},{status:400})}}let x=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/productos/route",pathname:"/api/productos",filename:"route",bundlePath:"app/api/productos/route"},resolvedPagePath:"C:\\Users\\dpovi\\Unimarket\\marketplace-facultad\\app\\api\\productos\\route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:y}=x,_="/api/productos/route";function q(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},77999:(e,t,r)=>{r.d(t,{Cr:()=>s,fT:()=>a});var o=r(41482),n=r.n(o),i=r(71615);function a(e,t={}){let r=process.env.JWT_SECRET;if(!r)throw Error("Falta JWT_SECRET");return n().sign(e,r,{expiresIn:"7d",...t})}function s(){try{let e=i.cookies().get("vendedor_token")?.value;if(!e)return null;let t=process.env.JWT_SECRET;return n().verify(e,t)}catch{return null}}},59094:(e,t,r)=>{r.d(t,{F:()=>s});var o=r(11185),n=r.n(o),i=r(39584);let a=new o.Schema({titulo:{type:String,required:!0,maxlength:100},descripcion:{type:String,required:!0,maxlength:500},precio:{type:Number,required:!0,min:0},categoria:{type:String,required:!0,enum:["utiles","comida","tecnologia","ropa","otros"]},imagenes:{type:[String],default:[],validate:[e=>e.length<=3,"M\xe1ximo 3 im\xe1genes"]},stock:{type:Number,required:!0,default:0,min:0},disponible:{type:Boolean,default:!0},vendedor_id:{type:String},vendedor_nombre:{type:String}},{timestamps:{createdAt:"fecha_creacion",updatedAt:"fecha_actualizacion"}});async function s(){return await (0,i.u)(),n().models.Product||n().model("Product",a,"productos")}},39584:(e,t,r)=>{r.d(t,{u:()=>u});let o=require("mongodb");var n=r(11185),i=r.n(n);let a=process.env.MONGODB_URI;if(!process.env.MONGODB_URI)throw Error("Add Mongo URI to .env.local");new o.MongoClient(a,{}).connect();let s=global._mongooseConn||null;async function u(){return s&&1===i().connection.readyState||(i().set("strictQuery",!0),s=await i().connect(a,{dbName:"marketplace"}),global._mongooseConn=s),s}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,261,67],()=>r(30093));module.exports=o})();